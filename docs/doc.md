# Сервис расписания для специалистов и клиентов

У **Специалиста** есть **Правила записи** (график работы и доступные временные слоты в формате JSON Time Slots). **Специалист** создаёт **Шаблоны событий** для клиентских запросов (например, пробный урок) и личного пользования (например, публичные групповые занятия). **Клиент** использует шаблоны специалиста для создания **Записи**, которая проходит каскадную валидацию (`Venue` → `Space` → `Specialist`). После подтверждения специалистом записи создаётся **Событие**. **Специалист** также может самостоятельно создавать события из любых шаблонов. **Владелец организации** настраивает `Organization`, `Venue`, `Space`, задаёт их **Правила записи** и назначает **Менеджеров**. **Менеджер** управляет расписанием `Venue`/`Space`, назначает `spaceId` для **Записей** в организации и получает уведомления о новых запросах. Независимые специалисты работают без `Venue`/`Space`, а уведомления координируют процессы между ролями.

Сервис предназначен для специалистов (йога, коучи, психологи, тренеры) и их клиентов, упрощая планирование, бронирование и проведение событий (уроков, консультаций, групповых занятий). Он предоставляет удобный интерфейс для управления расписанием и поддерживает интеграции с календарями и платформами для онлайн-встреч.

## Цели сервиса

- Упростить создание и управление расписанием для специалистов.
- Обеспечить клиентам удобный способ записи на события.
- Поддерживать различные типы событий (индивидуальные, групповые, онлайн/офлайн).

## Функциональность

1. **Правила записи специалиста**:

   - Специалист задаёт график работы (например, вторник с 10:00 до 14:00) и доступные временные слоты для записи.
   - Правила могут включать исключения (например, отпуск или разовые изменения).
   - Клиенты видят доступные слоты через календарь в интерфейсе.

2. **Шаблоны событий**:

   - Специалист создаёт шаблоны событий для:
     - Клиентских запросов (например, пробный урок, индивидуальная консультация).
     - Личного пользования (например, публичные групповые занятия или приватные события, такие как отпуск).
   - Шаблоны включают параметры: тип события, длительность, формат (онлайн/офлайн/гибрид), максимальное число участников, цена (если применимо), требования к клиентам (например, уровень подготовки).
   - Публичные групповые занятия отмечены как доступные для всех клиентов, приватные — только для специалиста.

3. **Запись**:

   - Клиент выбирает шаблон события и доступный слот (на основе правил записи) и создаёт запрос на запись, указывая желаемое время.
   - Специалист получает запрос, может подтвердить или отклонить его (с указанием причины).
   - Уведомления о статусе запроса отправляются клиенту (например, по email или SMS).

4. **Подтверждение и создание события**:

   - После подтверждения запроса специалистом создаётся событие с указанным временем, типом и другими параметрами из шаблона.
   - Событие добавляется в расписание специалиста и клиента.
   - Поддерживается оплата (если событие платное) и политика отмены (например, возврат средств за 24 часа).

5. **Прямое создание событий**:
   - Специалист может создавать события напрямую из любого шаблона (клиентского или личного) без запроса клиента.
   - Время и параметры события задаются в рамках правил записи.
   - Поддерживается создание повторяющихся событий (например, еженедельные групповые занятия).

## Ключевые сущности

- **Специалист**: Задаёт правила записи, создаёт шаблоны и события, подтверждает запросы.
- **Клиент**: Бронирует события, используя шаблоны специалиста.
- **Правила записи**: График работы и доступные слоты специалиста, включая исключения.
- **Шаблон события**: Набор параметров (тип, длительность, цена, доступность) для создания событий.
- **Запрос на запись**: Заявка клиента на участие в событии по шаблону.
- **Событие**: Конкретное занятие или встреча, созданное из шаблона или запроса.

## Дополнительные возможности

- **Уведомления**: Автоматические сообщения о подтверждении, отмене или напоминании о событии.
- **Оплата**: Поддержка платных событий с возможностью возврата средств.
- **Интеграции**: Синхронизация с календарями (Google, Outlook) и платформами для онлайн-встреч (Zoom, Microsoft Teams).
- **Повторяющиеся события**: Автоматическое создание регулярных событий (например, еженедельные занятия).
- **Отмена и перенос**: Политики отмены и возможность переноса событий.

# EventStatus

Перечисление `EventStatus` описывает возможные статусы событий (например, сессий) в системе расписания. Используется для управления состоянием сессий, таких как занятия йогой, тренировки в тире, уроки репетиторов или теннисные матчи.

- **PLANNED**: Сессия создана, но требует подтверждения (например, минимальное количество участников для групповой йоги).
- **CONFIRMED**: Сессия подтверждена, бронирования активны.
- **IN_PROGRESS**: Сессия идёт, новые бронирования запрещены.
- **COMPLETED**: Сессия завершена, бронирования переходят в `COMPLETED`.
- **CANCELED**: Сессия отменена, все бронирования обновляются до `CANCELED`.
- **POSTPONED**: Сессия перенесена, нужно уведомить клиентов и обновить `start_time`/`end_time`.

# Комбинации атрибутов EventType, EventDelivery, EventVisibility

Таблица описывает логичные комбинации атрибутов `EventType`, `EventDelivery` и `EventVisibility` для общих событий в системе расписания. Учитываются отпуска (видимые и невидимые) и другие типы событий (групповые, индивидуальные, пробные, консультации). `PRIVATE` в `EventType` заменено на `INDIVIDUAL` для ясности. Описания сценариев универсальны.

| EventType    | EventDelivery | EventVisibility | Сценарий                                                                           |
| ------------ | ------------- | --------------- | ---------------------------------------------------------------------------------- |
| GROUP        | OFFLINE       | PUBLIC          | Групповое событие, проводимое в физическом месте, открытое для всех.               |
| GROUP        | ONLINE        | PUBLIC          | Групповое событие, проводимое онлайн, открытое для всех.                           |
| GROUP        | HYBRID        | PUBLIC          | Групповое событие, проводимое в физическом месте и онлайн, открытое для всех.      |
| GROUP        | OFFLINE       | SERVICE         | Служебное групповое событие в физическом месте, невидимое для клиентов.            |
| GROUP        | ONLINE        | SERVICE         | Служебное групповое событие онлайн, невидимое для клиентов.                        |
| INDIVIDUAL   | OFFLINE       | PRIVATE         | Индивидуальное событие в физическом месте, доступное только приглашённым.          |
| INDIVIDUAL   | ONLINE        | PRIVATE         | Индивидуальное событие онлайн, доступное только приглашённым.                      |
| INDIVIDUAL   | HYBRID        | PRIVATE         | Индивидуальное событие в физическом месте и онлайн, доступное только приглашённым. |
| INDIVIDUAL   | OFFLINE       | SERVICE         | Служебное индивидуальное событие в физическом месте, невидимое для клиентов.       |
| INDIVIDUAL   | ONLINE        | SERVICE         | Служебное индивидуальное событие онлайн, невидимое для клиентов.                   |
| TRIAL        | OFFLINE       | PUBLIC          | Пробное событие в физическом месте, открытое для всех.                             |
| TRIAL        | ONLINE        | PUBLIC          | Пробное событие онлайн, открытое для всех.                                         |
| TRIAL        | HYBRID        | PUBLIC          | Пробное событие в физическом месте и онлайн, открытое для всех.                    |
| TRIAL        | OFFLINE       | SERVICE         | Служебное пробное событие в физическом месте, невидимое для клиентов.              |
| CONSULTATION | OFFLINE       | PUBLIC          | Консультация в физическом месте, открытая для всех.                                |
| CONSULTATION | ONLINE        | PUBLIC          | Консультация онлайн, открытая для всех.                                            |
| CONSULTATION | HYBRID        | PUBLIC          | Консультация в физическом месте и онлайн, открытая для всех.                       |
| CONSULTATION | OFFLINE       | PRIVATE         | Приватная консультация в физическом месте, для приглашённых.                       |
| CONSULTATION | ONLINE        | PRIVATE         | Приватная консультация онлайн, для приглашённых.                                   |
| CONSULTATION | HYBRID        | PRIVATE         | Приватная консультация в физическом месте и онлайн, для приглашённых.              |
| CONSULTATION | ONLINE        | SERVICE         | Служебная консультация онлайн, невидимая для клиентов.                             |
| VACATION     | NONE          | PUBLIC          | Видимый отпуск, отображается в календаре, бронирование невозможно.                 |
| VACATION     | NONE          | SERVICE         | Невидимый отпуск, не отображается, слоты заблокированы.                            |

## Пояснения

- **EventType**:
  - `GROUP`: События для нескольких участников.
  - `INDIVIDUAL`: События для одного участника (ранее `PRIVATE`).
  - `TRIAL`: Пробные события для привлечения участников.
  - `CONSULTATION`: События для обсуждения или рекомендаций.
  - `VACATION`: Отпуск, блокирующий расписание.
- **EventDelivery**:
  - `OFFLINE`: Событие в физическом месте.
  - `ONLINE`: Событие удалённо.
  - `HYBRID`: Событие в физическом месте и удалённо.
  - `NONE`: Без доставки (для отпуска).
- **EventVisibility**:
  - `PUBLIC`: Видно всем, обычно открыто для бронирования.
  - `PRIVATE`: Видно только приглашённым (требует `EventAccess`).
  - `SERVICE`: Невидимо для клиентов, для внутренних целей.

## Ограничения

- `VACATION`: Всегда `delivery = NONE`, `visibility = PUBLIC` (видимый) или `SERVICE` (невидимый).
- `INDIVIDUAL`: Обычно `visibility = PRIVATE` или `SERVICE`.
- `GROUP`, `TRIAL`: Обычно `visibility = PUBLIC`, иногда `SERVICE`.
- `CONSULTATION`: Гибко, поддерживает все `visibility`.

## Нелогичные комбинации (исключены)

- `VACATION` с `OFFLINE`, `ONLINE`, `HYBRID`: Отпуск не имеет доставки.
- `INDIVIDUAL` с `PUBLIC`: Индивидуальные события редко публичны.
- `GROUP` с `PRIVATE`: Групповые события не ограничиваются приглашёнными.
- `TRIAL` с `PRIVATE`: Пробные события обычно публичные.
